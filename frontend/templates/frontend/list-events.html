{% extends 'base.html' %}
{% block content %}
<div id="app">

    <div class="messages mt-2">
        	<div v-for="err_msg in err_messages">
                <div class="alert alert-danger">[[err_msg]]</div>
        </div>
    </div>

    <!--
    <ul class="list-group" v-for="event in events">
        <li class="list-group-item mb-2">[[event.name]]</li>
    </ul>
    -->
    <div v-for="event in events">

        <div v-if="event.detail">
            <p>Detail view</p>
        
        </div>
        <div v-else>
            <div v-on:click="event_detail(event)" class="card mb-3" >
                <img class="card-img-top" v-bind:src="[[event.image]]" alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title">[[event.name]]</h5>
                    <p class="card-text">[[event.descripton]]</p>
                    <!--<p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p> -->
                </div>
            </div>
        </div>
    </div>
<script>



    var vueapp = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            events: [],
            err_messages: [],
            _before_edit: new Object()
        },
        created () {
            this.api_call('http://localhost:8000/api/event/?format=json','GET')
            .then(response => {
                response.data.forEach(item => {
                    Object.assign(item,{'edit':false});
                    Object.assign(item,{'detail':false});
                    this.events.push(item);
                });
            })
        },
        methods: {
            event_detail: function(event){
                console.log(''.concat('event_detail ',event.name))
                this.invert_detail(event)
            },
            invert_detail: function(event){
                var new_events_array = []
                this.events.forEach(item => {
                    //if (item.id == event.id){
                    //    console.log("set detail to " + !item.detail + ", event_id: " + item.id)
                    //    item.detail = !item.detail;
                    //}
                    item.detail = !item.detail;
                    new_events_array.push(item)
                });
                this.events = new_events_array
                delete new_events_array
            },
            api_call: function(url,method,json_data="{}"){
                resp = this.async_api_call_axios(url,method,json_data)
                resp.catch(error => {
                    this.err_messages.push(error)
                });
                resp.finally(() => {
                    this.loading = false;
                });
                return resp
            },
            async_api_call_axios: async(url,method,json_data) =>{
                return await axios({
                    url: url,
                    method: method,
                    data: json_data,
                    proxy: '',
                    headers: {'Content-Type':'application/json','X-CSRFToken': Cookies.get('csrftoken')}
                });
            }
        }
        
    }); 

</script>
</div>

{% endblock content %}